{
  "info": {
    "name": "Deacons School API",
    "_postman_id": "deacons-school-api-collection",
    "description": "Complete Postman collection for Deacons School backend.\n\nVariables:\n- {{baseUrl}}: e.g. http://localhost:3000\n- {{token}}: JWT for normal authenticated users (students/teachers/supervisors/admins)\n- {{adminToken}}: JWT for admin user\n\nAuth:\n- Most protected routes expect Authorization: Bearer <token>.\n- Admin-only routes are documented in each request description.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000"
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "adminToken",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "Misc",
      "item": [
        {
          "name": "Health - Hello school",
          "request": {
            "method": "GET",
            "description": "Simple health check for the backend.\n\nResponse: plain text 'Hello school'.",
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            }
          }
        },
        {
          "name": "Static upload (example)",
          "request": {
            "method": "GET",
            "description": "Fetch a static uploaded file (profile image, curriculum file, hymn audio).\n\nReplace `profiles/example.jpg` with the real relative path returned by the APIs.",
            "url": {
              "raw": "{{baseUrl}}/uploads/profiles/example.jpg",
              "host": ["{{baseUrl}}"],
              "path": ["uploads", "profiles", "example.jpg"]
            }
          }
        }
      ]
    },
    {
      "name": "Auth & Users",
      "item": [
        {
          "name": "Register user (with image)",
          "request": {
            "method": "POST",
            "description": "Register a new user.\n\nURL: POST /api/users/register\nAuth: Public (no token).\nBody: form-data multipart.\n\nRequired fields:\n- name, phone (11 digits), password, birthday (YYYY-MM-DD), gender (male|female), code\n- For students: class_id is required (level_id is derived from the class)\n- For teachers: subject is required (taks|al7an|coptic)\n\nOptional:\n- role (defaults to student). For safety, only use from trusted admin flows.\n- image: profile image file (field name: image)",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                { "key": "name", "value": "Student Name", "type": "text" },
                { "key": "phone", "value": "01234567890", "type": "text" },
                { "key": "password", "value": "password123", "type": "text" },
                { "key": "birthday", "value": "2010-01-01", "type": "text" },
                { "key": "gender", "value": "male", "type": "text" },
                { "key": "code", "value": "S1234", "type": "text" },
                { "key": "class_id", "value": "1", "type": "text" },
                { "key": "image", "type": "file", "src": [] }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "register"]
            }
          }
        },
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "description": "Login with code and password.\n\nURL: POST /api/users/login\nAuth: Public.\n\nBody JSON:\n- code: user code (unique)\n- password: user password\n\nResponse:\n- token: JWT to be used in Authorization: Bearer <token>\n- user: user info with class and level snapshot.",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "login"]
            }
          }
        },
        {
          "name": "Get all users",
          "request": {
            "method": "GET",
            "description": "Get all users with level and class info.\n\nURL: GET /api/users/get-users\nAuth: Admin only.\n\nQuery params:\n- includeTeaching (optional, true|false): when true, includes 'teachingClasses' for teachers.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/get-users?includeTeaching=true",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "get-users"],
              "query": [{ "key": "includeTeaching", "value": "true" }]
            }
          }
        },
        {
          "name": "Get user by ID",
          "request": {
            "method": "GET",
            "description": "Get a single user with level, class, and teaching classes.\n\nURL: GET /api/users/:id\nAuth: Any authenticated user (admin, teacher, student, etc.).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "1"]
            }
          }
        },
        {
          "name": "Update profile image",
          "request": {
            "method": "PUT",
            "description": "Update user profile image.\n\nURL: PUT /api/users/:id/image\nAuth: Bearer token. User may update their own image; admins may update anyone.\n\nBody: form-data multipart\n- image: file (field name: image).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "image", "type": "file", "src": [] }]
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/1/image",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "1", "image"]
            }
          }
        },
        {
          "name": "Change password",
          "request": {
            "method": "PUT",
            "description": "Change user password.\n\nURL: PUT /api/users/:id/password\nAuth: Bearer token.\n- Non-admin: must provide currentPassword and newPassword.\n- Admin: can provide only newPassword; currentPassword is not required.\n\nBody JSON:\n- currentPassword (required for non-admin)\n- newPassword (min 6 chars).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"currentPassword\": \"oldpass\",\n  \"newPassword\": \"newpass123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/1/password",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "1", "password"]
            }
          }
        },
        {
          "name": "Delete user",
          "request": {
            "method": "DELETE",
            "description": "Delete a user by ID.\n\nURL: DELETE /api/users/delete/:id\nAuth: Admin only.\n\nAlso deletes the user's profile image file if present.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/delete/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "delete", "1"]
            }
          }
        },
        {
          "name": "Get teachers by subject",
          "request": {
            "method": "GET",
            "description": "Get all teachers grouped by subject.\n\nURL: GET /api/users/teachers-by-subject\nAuth: Staff (teachers/supervisors/admins).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/teachers-by-subject",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "teachers-by-subject"]
            }
          }
        },
        {
          "name": "Get teacher classes",
          "request": {
            "method": "GET",
            "description": "Get all classes assigned to a teacher or supervisor.\n\nURL: GET /api/users/teacher/:userId/classes\nAuth: Typically staff/admin; not enforced by role here but protected by auth.\n\nResponse includes both many-to-many teachingClasses and subject-based assignments.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/teacher/1/classes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "teacher", "1", "classes"]
            }
          }
        },
        {
          "name": "Assign classes to teacher",
          "request": {
            "method": "POST",
            "description": "Assign up to 3 classes to a teacher or supervisor.\n\nURL: POST /api/users/assign-classes\nAuth: Admin (recommended).\n\nBody JSON:\n- userId: teacher/supervisor user id\n- classIds: array of class ids, max length 3.\n\nAlso enforces a global cap of 3 classes including subject-based assignments.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": 1,\n  \"classIds\": [1, 2]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/assign-classes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "assign-classes"]
            }
          }
        },
        {
          "name": "Remove all teacher classes",
          "request": {
            "method": "DELETE",
            "description": "Remove all class associations from a teacher or supervisor (many-to-many mapping only).\n\nURL: DELETE /api/users/teacher/:userId/classes\nAuth: Admin (recommended).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/teacher/1/classes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "teacher", "1", "classes"]
            }
          }
        },
        {
          "name": "Get teachers with classes",
          "request": {
            "method": "GET",
            "description": "Get all teachers and supervisors with their assigned classes and image URLs.\n\nURL: GET /api/users/teachers-with-classes\nAuth: Staff/admin.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/teachers-with-classes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "teachers-with-classes"]
            }
          }
        },
        {
          "name": "Bulk import students",
          "request": {
            "method": "POST",
            "description": "Bulk import students from CSV or Excel.\n\nURL: POST /api/users/bulk-import\nAuth: Admin only.\nBody: form-data multipart.\n\nFields:\n- file: CSV/XLS/XLSX file (field: file)\n- classId (optional): assign all rows to this class id. If omitted, each row must have a class location column.\n\nNotes:\n- All imported users are created with role 'student'.\n- Phone format must be 11 digits.\n- Duplicates are checked by code only.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                { "key": "file", "type": "file", "src": [] },
                {
                  "key": "classId",
                  "value": "1",
                  "type": "text",
                  "disabled": false
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/bulk-import",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "bulk-import"]
            }
          }
        },
        {
          "name": "Bulk import teachers",
          "request": {
            "method": "POST",
            "description": "Bulk import teachers from CSV or Excel.\n\nURL: POST /api/users/bulk-import-teachers\nAuth: Admin only.\nBody: form-data multipart.\n\nFields:\n- file: CSV/XLS/XLSX file (field: file)\n\nRequired columns per row: name, phone, birthday, gender, code, subject (taks|al7an|coptic).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": [] }]
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/bulk-import-teachers",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "bulk-import-teachers"]
            }
          }
        },
        {
          "name": "Get school stats",
          "request": {
            "method": "GET",
            "description": "Get aggregated statistics about users, classes, and levels.\n\nURL: GET /api/users/stats\nAuth: Public (no auth in router).\n\nResponse includes:\n- users: total, students, teachers, admins, supervisors\n- classes: total and byLevel\n- levels: total and studentsByLevel.",
            "url": {
              "raw": "{{baseUrl}}/api/users/stats",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "stats"]
            }
          }
        }
      ]
    },
    {
      "name": "Classes",
      "item": [
        {
          "name": "Create class",
          "request": {
            "method": "POST",
            "description": "Create a new class.\n\nURL: POST /api/classes\nAuth: Admin only.\n\nBody JSON:\n- level_id: existing level id\n- location: classroom location string.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"level_id\": 1,\n  \"location\": \"Classroom A\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/classes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes"]
            }
          }
        },
        {
          "name": "Get all classes",
          "request": {
            "method": "GET",
            "description": "Get all classes with level info, students_count, and students_preview.\n\nURL: GET /api/classes\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/classes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes"]
            }
          }
        },
        {
          "name": "Get class by ID",
          "request": {
            "method": "GET",
            "description": "Get a single class by ID with level info and students_count.\n\nURL: GET /api/classes/:id\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/classes/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes", "1"]
            }
          }
        },
        {
          "name": "Get class details",
          "request": {
            "method": "GET",
            "description": "Get detailed class information including students, teachers list, students_count, and embedded schedule if available.\n\nURL: GET /api/classes/:id/details\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/details",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes", "1", "details"]
            }
          }
        },
        {
          "name": "Update class",
          "request": {
            "method": "PUT",
            "description": "Update class location and/or level.\n\nURL: PUT /api/classes/:id\nAuth: Admin only.\n\nBody JSON (partial allowed):\n- location\n- level_id",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"location\": \"Updated classroom\",\n  \"level_id\": 2\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/classes/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes", "1"]
            }
          }
        },
        {
          "name": "Delete class",
          "request": {
            "method": "DELETE",
            "description": "Delete a class.\n\nURL: DELETE /api/classes/:id\nAuth: Admin only.\n\nFails if there are still students linked to the class.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/classes/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes", "1"]
            }
          }
        },
        {
          "name": "Get teacher assignments for class",
          "request": {
            "method": "GET",
            "description": "Get assigned teachers for taks, al7an, coptic for a class.\n\nURL: GET /api/classes/:id/teacher-assignments\nAuth: Public (no auth in router).",
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/teacher-assignments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes", "1", "teacher-assignments"]
            }
          }
        },
        {
          "name": "Update teacher assignments for class",
          "request": {
            "method": "PUT",
            "description": "Assign or update teachers for a class per subject.\n\nURL: PUT /api/classes/:id/teacher-assignments\nAuth: Public at router level, but SHOULD be restricted in production.\n\nBody JSON (all optional, partial updates allowed):\n- taks_teacher_id\n- al7an_teacher_id\n- coptic_teacher_id\n\nEach teacher has a cap of 3 classes total across subject assignments and many-to-many mapping.",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"taks_teacher_id\": 1,\n  \"al7an_teacher_id\": 2,\n  \"coptic_teacher_id\": 3\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/teacher-assignments",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes", "1", "teacher-assignments"]
            }
          }
        }
      ]
    },
    {
      "name": "Levels",
      "item": [
        {
          "name": "Create level",
          "request": {
            "method": "POST",
            "description": "Create a new level (combination of level + stage).\n\nURL: POST /api/levels\nAuth: Public at router level, but should be admin-only in production.\n\nBody JSON:\n- level (number)\n- stage (number)",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"level\": 1,\n  \"stage\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/levels",
              "host": ["{{baseUrl}}"],
              "path": ["api", "levels"]
            }
          }
        },
        {
          "name": "Get all levels",
          "request": {
            "method": "GET",
            "description": "Get all levels ordered by level and stage.\n\nURL: GET /api/levels\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/levels",
              "host": ["{{baseUrl}}"],
              "path": ["api", "levels"]
            }
          }
        },
        {
          "name": "Get level by ID (with aggregates)",
          "request": {
            "method": "GET",
            "description": "Get level summary: student count, classes count, curriculum count, and list of classes.\n\nURL: GET /api/levels/:id\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/levels/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "levels", "1"]
            }
          }
        },
        {
          "name": "Update level",
          "request": {
            "method": "PUT",
            "description": "Update level number and/or stage.\n\nURL: PUT /api/levels/:id\nAuth: Public at router level, should be admin-only.\n\nBody JSON:\n- level (optional)\n- stage (optional).\n\nPrevents duplicate level+stage combinations.",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"level\": 2,\n  \"stage\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/levels/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "levels", "1"]
            }
          }
        },
        {
          "name": "Delete level",
          "request": {
            "method": "DELETE",
            "description": "Delete a level.\n\nURL: DELETE /api/levels/:id\nAuth: Public at router level, should be admin-only.\n\nFails if there are classes attached to the level.",
            "url": {
              "raw": "{{baseUrl}}/api/levels/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "levels", "1"]
            }
          }
        }
      ]
    },
    {
      "name": "Curriculum",
      "item": [
        {
          "name": "Get curriculum for class",
          "request": {
            "method": "GET",
            "description": "Get curriculum entries for a class.\n\nURL: GET /api/classes/:classId/curriculum\nAuth: Any authenticated user.\n\nQuery params:\n- subject (optional: taks|al7an|coptic)\n- semester (optional: 1|2)\n\nFor subject=al7an, response includes linked hymns with event and audio URLs.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/curriculum?subject=taks&semester=1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "classes", "1", "curriculum"],
              "query": [
                { "key": "subject", "value": "taks" },
                { "key": "semester", "value": "1" }
              ]
            }
          }
        },
        {
          "name": "Upload single lecture file (legacy)",
          "request": {
            "method": "POST",
            "description": "Upload a single file for a lecture (legacy endpoint).\n\nURL: POST /api/classes/:classId/curriculum/:subject/semesters/:semester/lectures/:lecture\nAuth: Admin only.\n\nBody: form-data\n- file: binary file (field: file).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": [] }]
            },
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/curriculum/taks/semesters/1/lectures/1",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "classes",
                "1",
                "curriculum",
                "taks",
                "semesters",
                "1",
                "lectures",
                "1"
              ]
            }
          }
        },
        {
          "name": "Upload multiple lecture files",
          "request": {
            "method": "POST",
            "description": "Upload multiple files (audio, PDF, video) for a lecture.\n\nURL: POST /api/classes/:classId/curriculum/:subject/semesters/:semester/lectures/:lecture/multiple\nAuth: Admin only.\n\nBody: form-data\n- files[]: multiple files (field name as configured in middleware).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "files",
                  "type": "file",
                  "src": [],
                  "description": "Upload multiple files; field name may differ depending on middleware setup."
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/curriculum/taks/semesters/1/lectures/1/multiple",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "classes",
                "1",
                "curriculum",
                "taks",
                "semesters",
                "1",
                "lectures",
                "1",
                "multiple"
              ]
            }
          }
        },
        {
          "name": "Upload specific file type for lecture",
          "request": {
            "method": "POST",
            "description": "Upload a specific file type for a lecture.\n\nURL: POST /api/classes/:classId/curriculum/:subject/semesters/:semester/lectures/:lecture/:fileType\nAuth: Admin only.\n\nParams:\n- fileType: audio | pdf | video\n\nBody: form-data\n- file: binary file (field: file).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "file", "type": "file", "src": [] }]
            },
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/curriculum/taks/semesters/1/lectures/1/audio",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "classes",
                "1",
                "curriculum",
                "taks",
                "semesters",
                "1",
                "lectures",
                "1",
                "audio"
              ]
            }
          }
        },
        {
          "name": "Delete lecture file (by type)",
          "request": {
            "method": "DELETE",
            "description": "Delete a file of a specific type for a lecture.\n\nURL: DELETE /api/classes/:classId/curriculum/:subject/semesters/:semester/lectures/:lecture/:fileType\nAuth: Admin only.\n\nParams:\n- fileType: audio | pdf | video.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/curriculum/taks/semesters/1/lectures/1/pdf",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "classes",
                "1",
                "curriculum",
                "taks",
                "semesters",
                "1",
                "lectures",
                "1",
                "pdf"
              ]
            }
          }
        },
        {
          "name": "Set hymns for al7an lecture",
          "request": {
            "method": "PUT",
            "description": "Replace hymns set for an al7an lecture.\n\nURL: PUT /api/classes/:classId/curriculum/:subject/semesters/:semester/lectures/:lecture/hymns\nAuth: Admin only.\n\nBody JSON:\n- hymns: array of objects [{ hymn_id, lyrics_variants, sort_order }]\n  - hymn_id: string UUID\n  - lyrics_variants: array of 'arabic' | 'coptic' | 'arabic_coptic'\n  - sort_order: optional integer for display order.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"hymns\": [\n    {\n      \"hymn_id\": \"00000000-0000-0000-0000-000000000001\",\n      \"lyrics_variants\": [\"arabic\", \"coptic\"],\n      \"sort_order\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/classes/1/curriculum/al7an/semesters/1/lectures/1/hymns",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "classes",
                "1",
                "curriculum",
                "al7an",
                "semesters",
                "1",
                "lectures",
                "1",
                "hymns"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Schedule",
      "item": [
        {
          "name": "Generate schedule",
          "request": {
            "method": "POST",
            "description": "Generate an automatic schedule for classes.\n\nURL: POST /api/schedule/generate\nAuth: Public at router level, should be restricted to admins/staff.\n\nBody JSON (optional):\n- classIds: array of class ids to restrict generation to\n- subjectTeachers: optional map { taks: [teacherIds], al7an: [...], coptic: [...] }\n\nIf subjectTeachers is omitted, it will auto-load teachers from DB by subject.",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"classIds\": [],\n  \"subjectTeachers\": {}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/schedule/generate",
              "host": ["{{baseUrl}}"],
              "path": ["api", "schedule", "generate"]
            }
          }
        },
        {
          "name": "Apply schedule (validate only)",
          "request": {
            "method": "POST",
            "description": "Validate a proposed schedule without saving it.\n\nURL: POST /api/schedule/apply\nAuth: Public at router level.\n\nBody JSON:\n- rows: array of rows each like { class: { id, location, level }, A: { subject, teacherId }, B: {...}, C: {...} }\n\nChecks:\n- 3 distinct subjects per class\n- teacher specialty matches subject\n- no teacher appears twice in the same time slot\n- no teacher exceeds 3 classes total.",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rows\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/schedule/apply",
              "host": ["{{baseUrl}}"],
              "path": ["api", "schedule", "apply"]
            }
          }
        },
        {
          "name": "Save schedule",
          "request": {
            "method": "POST",
            "description": "Persist a validated schedule to the database.\n\nURL: POST /api/schedule/save\nAuth: Public at router level, should be restricted in production.\n\nBody JSON:\n- rows: same shape as /apply\n\nSaves per-class subject assignments in TeacherSubjectAssignment.",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rows\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/schedule/save",
              "host": ["{{baseUrl}}"],
              "path": ["api", "schedule", "save"]
            }
          }
        },
        {
          "name": "Get current schedule",
          "request": {
            "method": "GET",
            "description": "Get the currently saved schedule.\n\nURL: GET /api/schedule/current\nAuth: Public.\n\nResponse:\n- timeSlots, subjects, subjectSlotByClass, rows[], teacherLookup.",
            "url": {
              "raw": "{{baseUrl}}/api/schedule/current",
              "host": ["{{baseUrl}}"],
              "path": ["api", "schedule", "current"]
            }
          }
        }
      ]
    },
    {
      "name": "Events",
      "item": [
        {
          "name": "Get all events",
          "request": {
            "method": "GET",
            "description": "Get all active events.\n\nURL: GET /api/events\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/events",
              "host": ["{{baseUrl}}"],
              "path": ["api", "events"]
            }
          }
        },
        {
          "name": "Get event by ID",
          "request": {
            "method": "GET",
            "description": "Get event by id.\n\nURL: GET /api/events/:id\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/events/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "events", "1"]
            }
          }
        },
        {
          "name": "Create event",
          "request": {
            "method": "POST",
            "description": "Create a new event.\n\nURL: POST /api/events\nAuth: Admin only.\n\nBody JSON:\n- name (required)\n- name_arabic (optional)\n- description (optional)\n- color (optional, default #3B82F6)\n- icon (optional).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Nativity\",\n  \"name_arabic\": \"عيد الميلاد\",\n  \"description\": \"Nativity feast\",\n  \"color\": \"#FF0000\",\n  \"icon\": \"star\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/events",
              "host": ["{{baseUrl}}"],
              "path": ["api", "events"]
            }
          }
        },
        {
          "name": "Update event",
          "request": {
            "method": "PUT",
            "description": "Update an existing event.\n\nURL: PUT /api/events/:id\nAuth: Admin only.\n\nBody JSON: same fields as create, all optional + is_active.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Nativity Updated\",\n  \"is_active\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/events/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "events", "1"]
            }
          }
        },
        {
          "name": "Delete event",
          "request": {
            "method": "DELETE",
            "description": "Delete an event.\n\nURL: DELETE /api/events/:id\nAuth: Admin only.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/events/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "events", "1"]
            }
          }
        }
      ]
    },
    {
      "name": "Hymns",
      "item": [
        {
          "name": "Get hymns",
          "request": {
            "method": "GET",
            "description": "Get all active hymns, optionally filtered by event and search text.\n\nURL: GET /api/hymns\nAuth: Public.\n\nQuery parameters:\n- event_id (optional): filter by event\n- search (optional): search title and lyrics.",
            "url": {
              "raw": "{{baseUrl}}/api/hymns?event_id=&search=",
              "host": ["{{baseUrl}}"],
              "path": ["api", "hymns"],
              "query": [
                { "key": "event_id", "value": "", "disabled": false },
                { "key": "search", "value": "", "disabled": false }
              ]
            }
          }
        },
        {
          "name": "Get hymn by ID",
          "request": {
            "method": "GET",
            "description": "Get a hymn by id with event info and audio URL.\n\nURL: GET /api/hymns/:id\nAuth: Public.",
            "url": {
              "raw": "{{baseUrl}}/api/hymns/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "hymns", "1"]
            }
          }
        },
        {
          "name": "Create hymn",
          "request": {
            "method": "POST",
            "description": "Create a new hymn.\n\nURL: POST /api/hymns\nAuth: Admin only.\n\nBody JSON:\n- title_arabic (required)\n- event_id (required)\n- lyrics_arabic, lyrics_coptic, lyrics_arabic_coptic (optional)\n- description (optional)\n- duration (optional).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title_arabic\": \"لحن جديد\",\n  \"event_id\": 1,\n  \"lyrics_arabic\": \"...\",\n  \"lyrics_coptic\": \"...\",\n  \"lyrics_arabic_coptic\": \"...\",\n  \"description\": \"Description\",\n  \"duration\": 300\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/hymns",
              "host": ["{{baseUrl}}"],
              "path": ["api", "hymns"]
            }
          }
        },
        {
          "name": "Update hymn",
          "request": {
            "method": "PUT",
            "description": "Update a hymn.\n\nURL: PUT /api/hymns/:id\nAuth: Admin only.\n\nBody JSON: same fields as create plus is_active.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title_arabic\": \"تم التعديل\",\n  \"is_active\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/hymns/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "hymns", "1"]
            }
          }
        },
        {
          "name": "Delete hymn",
          "request": {
            "method": "DELETE",
            "description": "Delete a hymn.\n\nURL: DELETE /api/hymns/:id\nAuth: Admin only.",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/hymns/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "hymns", "1"]
            }
          }
        },
        {
          "name": "Upload hymn audio",
          "request": {
            "method": "POST",
            "description": "Upload or replace hymn audio file.\n\nURL: POST /api/hymns/:id/audio\nAuth: Admin only.\n\nBody: form-data\n- audio: audio file (field: audio).",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [{ "key": "audio", "type": "file", "src": [] }]
            },
            "url": {
              "raw": "{{baseUrl}}/api/hymns/1/audio",
              "host": ["{{baseUrl}}"],
              "path": ["api", "hymns", "1", "audio"]
            }
          }
        }
      ]
    }
  ]
}
